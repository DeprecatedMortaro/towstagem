#!/usr/bin/env ruby
action = ARGV.first
if action == 'new'
  project = ARGV[1]
  Dir.mkdir project
  configru = "require './app'\n"
  configru += "run Sinatra::Application"
  File.open("#{project}/config.ru", 'w') {|f| f.write(configru) }
  gemfile = "source :rubygems \n"
  gemfile += "gem 'towsta'\n\n"
  gemfile += "group :development do\n"
  gemfile += "  gem 'shotgun'\n"
  gemfile += 'end'
  File.open("#{project}/Gemfile", 'w') {|f| f.write(gemfile) }
  apprb = "#coding: utf-8 \n"
  apprb += "require 'towsta'\n\n"
  apprb += "$towsta_secret = '#{ARGV[2]}'\n"
  apprb += "$towsta_cache = true\n\n"
  apprb += "get '/' do\n"
  apprb += "  sync_with_towsta\n"
  apprb += "  haml :index\n"
  apprb += "end\n"
  File.open("#{project}/app.rb", 'w') {|f| f.write(apprb) }
  Dir.mkdir "#{project}/views"
  index = '%h1 Hello Towsta'
  File.open("#{project}/views/index.haml", 'w') {|f| f.write(index)}
  Dir.mkdir "#{project}/models"
  Dir.mkdir "#{project}/public"
  Dir.mkdir "#{project}/views/stylesheets"
  css = "@import compass/reset\n"
  css += "@import compass/css3\n\n"
  css += "$wrapper: 940px\n\n"
  css += ".wrapper\n"
  css += "  :width $wrapper\n"
  css += "  :margin 0 auto\n"
  css += "#top, #middle, #bottom\n"
  css += "  :float left\n"
  css += "  :width 100%"
  File.open("#{project}/views/stylesheets/#{project}.sass", 'w') {|f| f.write(css)}
  Dir.mkdir "#{project}/views/partials"
  head = "%title #{project}\n"
  head += "%meta{'http-equiv' => 'Content-Type', :content => 'text/html', :charset => 'utf-8'}\n"
  head += "%link{:rel => 'stylesheet', :type =>'text/css', :href => '/stylesheets/#{project}.css'}\n"
  head += "%link{:rel => 'shortcut icon', :type=> 'image/x-icon', :href => '/images/favicon.png'}\n"
  head += "%script{:src => '/js/jquery.js'}\n"
  head += "%script{:src => '/js/#{project}.js'}"
  File.open("#{project}/views/partials/_head.haml", 'w') {|f| f.write(head)}
  Dir.mkdir "#{project}/public/js"
  js = "$(function() {\n\n"
  js += "});"
  File.open("#{project}/public/js/#{project}.js", 'w') {|f| f.write(js)}
  Dir.mkdir "#{project}/public/images"
end
